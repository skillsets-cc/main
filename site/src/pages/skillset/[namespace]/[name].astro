---
import BaseLayout from '@layouts/BaseLayout.astro';
import StarButton from '@components/StarButton';
import CopyCommand from '@components/CopyCommand';
import ProofGallery from '@components/ProofGallery.astro';
import { mockSkillsets } from '@/utils/mockData';
import type { Skillset } from '@/types';

const { namespace, name } = Astro.params;

const skillsetId = `${namespace}/${name}`;
const skillsetEntry = mockSkillsets.find(s => s.id === skillsetId);

if (!skillsetEntry) {
  return Astro.redirect('/404');
}

const skillset: Skillset = {
  schema_version: '1.0',
  name: skillsetEntry.name,
  version: skillsetEntry.version,
  description: skillsetEntry.description,
  author: {
    handle: skillsetEntry.author,
    url: `https://github.com/${skillsetEntry.author.replace('@', '')}`,
  },
  verification: {
    production_url: 'https://example.com/shipped-product',
    audit_report: './AUDIT_REPORT.md',
  },
  tags: skillsetEntry.tags,
  compatibility: {
    claude_code_version: '>=1.0.0',
    languages: ['any'],
  },
  status: 'active',
  entry_point: './content/CLAUDE.md',
};

const installCommand = `npx skillsets install ${skillsetId}`;
---

<BaseLayout title={`${skillset.name} - Skillsets.cc`}>
  <article class="max-w-4xl mx-auto px-4 py-12">
    <header class="mb-8">
      <div class="flex items-start justify-between mb-6">
        <div>
          <h1 class="text-4xl font-bold font-serif mb-2 text-text-ink">{skillset.name}</h1>
          <p class="text-text-secondary font-serif">
            by <a href={skillset.author.url} class="text-orange-500 hover:underline" target="_blank" rel="noopener noreferrer">
              {skillset.author.handle}
            </a>
          </p>
        </div>

        <StarButton
          client:load
          skillsetId={skillsetId}
          initialStars={skillsetEntry.stars}
          initialStarred={false}
        />
      </div>

      <p class="text-lg text-text-secondary mb-6 font-serif leading-relaxed">{skillset.description}</p>

      <div class="flex flex-wrap gap-2 mb-6">
        {skillset.tags.map((tag) => (
          <span class="px-3 py-1 text-sm font-mono border border-border-ink bg-stone-50 text-text-secondary">
            {tag}
          </span>
        ))}
      </div>

      <div class="flex items-center gap-4 text-sm text-text-tertiary font-mono">
        <span class="flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
          </svg>
          Version {skillset.version}
        </span>
        <span class="flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
          </svg>
          {skillset.status}
        </span>
      </div>
    </header>

    <div class="space-y-6">
      <section class="border border-border-ink bg-stone-50 p-6 rounded-none">
        <h2 class="text-sm font-bold font-mono mb-4 text-text-ink uppercase tracking-wider border-b border-border-ink pb-2 inline-block">README</h2>
        <div class="prose prose-sm max-w-none text-text-secondary font-serif leading-relaxed">
          <p>
            This is a production-verified skillset that has been validated and tested in real-world applications.
            It includes complete documentation, audit reports, and proof of production usage.
          </p>
          <!-- README content will be rendered here -->
        </div>
      </section>

      <CopyCommand client:load command={installCommand} />

      <ProofGallery
        productionUrl={skillset.verification.production_url}
        hasAuditReport={!!skillset.verification.audit_report}
      />

      <section>
        <h2 class="text-sm font-bold font-mono mb-4 text-text-ink uppercase tracking-wider">Compatibility</h2>
        <dl class="space-y-3">
          <div>
            <dt class="text-xs uppercase tracking-wider font-bold text-text-tertiary mb-1">Claude Code Version</dt>
            <dd class="font-mono text-sm text-text-ink">{skillset.compatibility.claude_code_version}</dd>
          </div>
          <div>
            <dt class="text-xs uppercase tracking-wider font-bold text-text-tertiary mb-1">Languages</dt>
            <dd class="font-mono text-sm text-text-ink">{skillset.compatibility.languages.join(', ')}</dd>
          </div>
        </dl>
      </section>
    </div>

    <div class="mt-8 text-center">
      <a href="/browse" class="text-orange-500 hover:underline font-serif italic">
        ‚Üê Back to all skillsets
      </a>
    </div>
  </article>
</BaseLayout>
