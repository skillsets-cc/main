# index.ts

## Purpose
Defines TypeScript interfaces for skillsets, search index, and related data structures. Provides type safety across the site module for skillset metadata, verification, and search index entries.

## Public API
| Export | Type | Description |
|--------|------|-------------|
| `SearchIndex` | interface | Root search index structure (version, generated_at, skillsets array) |
| `SearchIndexEntry` | interface | Skillset entry in search index (id, name, description, verification, checksum, files, batch_id) |
| `McpServer` | interface | MCP server configuration (stdio/http/docker type, command/args/url/image) |
| `McpNestedServer` | interface | Nested MCP server config (for aggregator types like docker-compose) |
| `SlotStatus` | type | Reservation slot status union type ('available' \| 'reserved' \| 'submitted') |
| `GhostSlot` | interface | Single ghost entry slot (slotId, status, expiresAt, skillsetId) |
| `ReservationState` | interface | Complete reservation system state (slots, totalGhostSlots, cohort, userSlot) |

## Dependencies
- **Internal**: None (pure types)
- **External**: None

## Integration Points
- **Used by**:
  - `lib/data.ts` (type imports for search index access)
  - `pages/index.astro`, `pages/browse.astro`, `pages/skillset/[namespace]/[name].astro` (type-safe props)
  - `components/SkillsetGrid.tsx`, `components/GhostCard.tsx` (component props)
  - `pages/api/reservations.ts`, `pages/api/reservations/*.ts` (reservation API types)
- **Consumes**: No external services
- **Emits**: No events

## Key Logic

### SearchIndex Interface
- `version`: Index schema version
- `generated_at`: ISO timestamp of index generation
- `skillsets`: Array of SearchIndexEntry objects

### SearchIndexEntry Interface
Contains all skillset metadata for search and display:
- **Identity**: `id` (namespace/name), `name`, `version`, `description`, `status`
- **Discovery**: `tags` array, `author` object (handle, url)
- **Verification**: `verification` object with production_links, production_proof, audit_report
- **Compatibility**: `compatibility` object with claude_code_version, languages
- **Install**: `entry_point` path, `checksum` hash, `files` record (path â†’ checksum)
- **Metrics**: `stars` count (hydrated from KV at build time)
- **MCP**: Optional `mcp_servers` array for skillsets using Model Context Protocol
- **Ghost Entry**: Optional `batch_id` field (format: `{position}.{batchSize}.{cohort}`) for ghost entry identification
- **Context**: Optional `context_image_url` for visual context (e.g., screenshot)

### Verification Structure
- `production_links`: Array of {url, label?} for deployed examples
- `production_proof`: Optional path to proof document
- `audit_report`: Required path to audit report (generated by /audit-skill)

### Compatibility Structure
- `claude_code_version`: Semver range (e.g., ">=1.0.0")
- `languages`: Array of language identifiers (["any"] for language-agnostic)

### MCP Server Structures
- **McpServer**: Top-level MCP server config with discriminated `type` field:
  - `stdio`: Command + args (e.g., `npx -y @upstash/context7-mcp`)
  - `http`: URL endpoint
  - `docker`: Image + optional nested servers array
- **McpNestedServer**: For aggregator images (docker-compose) with multiple servers
- **Fields**: `name`, `mcp_reputation`, `researched_at` (timestamp of manual review)

### Reservation Types
- **SlotStatus**: Union type defining valid slot states: 'available' (unclaimed), 'reserved' (held with TTL), 'submitted' (PR opened)
- **GhostSlot**: Single slot state for UI (slotId, status enum, optional expiresAt/skillsetId)
- **ReservationState**: Complete system snapshot returned by `/api/reservations` (slots map, config, user's current slot)
