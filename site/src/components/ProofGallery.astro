---
interface ProductionLink {
  url: string;
  label?: string;
}

interface Props {
  productionLinks: ProductionLink[];
  hasAuditReport: boolean;
  skillsetId: string;
}

const { productionLinks, hasAuditReport, skillsetId } = Astro.props;

// Extract base domain from URL
function getBaseDomain(url: string): string {
  try {
    const parsed = new URL(url);
    return parsed.hostname;
  } catch {
    return url;
  }
}

// Build GitHub URL for audit report
const encodedId = skillsetId.replace('@', '%40');
const auditReportUrl = `https://github.com/skillsets-cc/main/blob/main/skillsets/${encodedId}/AUDIT_REPORT.md`;
---

<section class="p-6 rounded-none">
  <h2 class="text-sm font-bold font-mono mb-4 text-text-ink uppercase tracking-wider border-b border-border-ink pb-2 inline-block">Verification Proofs</h2>

  <div class="space-y-4">
    <div class="flex items-start gap-4">
      <div class="w-1 h-full min-h-[40px] bg-orange-500 flex-shrink-0"></div>
      <div>
        <h3 class="font-bold font-serif text-text-ink mb-1">Production Verified</h3>
        <p class="text-text-secondary text-sm font-serif mb-2 leading-relaxed">
          This skillset was used to build:
        </p>
        <div class="space-y-1">
          {productionLinks.map((link) => (
            <a
              href={link.url}
              class="block text-orange-500 hover:underline text-sm font-mono"
              target="_blank"
              rel="noopener noreferrer"
            >
              {link.label || getBaseDomain(link.url)}
            </a>
          ))}
        </div>
      </div>
    </div>

    {hasAuditReport && (
      <div class="flex items-start gap-4">
        <div class="w-1 h-full min-h-[40px] bg-orange-500 flex-shrink-0"></div>
        <div>
          <h3 class="font-bold font-serif text-text-ink mb-1">Audit Complete</h3>
          <p class="text-text-secondary text-sm font-serif mb-2 leading-relaxed">
            Validated with official audit skill.
          </p>
          <a
            href={auditReportUrl}
            class="text-orange-500 hover:underline text-sm font-mono"
            target="_blank"
            rel="noopener noreferrer"
          >
            View audit report
          </a>
        </div>
      </div>
    )}

    <div class="flex items-start gap-4">
        <div class="w-1 h-full min-h-[40px] bg-orange-500 flex-shrink-0"></div>
      <div>
        <h3 class="font-bold font-serif text-text-ink mb-1">Schema Valid</h3>
        <p class="text-text-secondary text-sm font-serif leading-relaxed">
          Passed JSON schema validation.
        </p>
      </div>
    </div>
  </div>
</section>
